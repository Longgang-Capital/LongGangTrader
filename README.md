# LongGangTrader

!!!!大家记得在自己的branch中提交代码!!!

我们每周把大家的branch整合到main分支中

#### 任务分工（初版）

+ 数据读写、预处理(LHH)
  + akshare, baostock,
+ 因子计算
  + 自己研发的因子（待定）
  + Alpha 158(HYJ)
+ 因子检验 & 因子合成
  + 机器学习合成因子(HYJ)
  + 因子检验：IC, ICIR,...（ZH）
  + 调仓周期：1d， 5d，20d
+ 回测
  + Barra风格归因(LHH)
  + 组合优化(MYJ)
  + 向量化回测框架(MYJ，LTY，vwap->计算滑点)
+ （可视化网页结果：模拟实盘）
+ 报告与课件(ZES)

#### 任务分工（新版）

+ 数据读写、预处理(√)
  + akshare, baostock,
+ 因子计算
  + 自己研发的因子（待定）
  + Alpha 158(√)
+ 因子检验 & 因子合成
  + 机器学习合成因子(HYJ)(√)
  + 因子检验：IC, ICIR,...（ZH）
  + 调仓周期：1d， 5d，20d(三个都试一下，√)
+ 回测
  + Barra风格归因(LHH，√)
  + 组合优化(MYJ)
  + 回测框架(MYJ，LTY，vwap->计算滑点)(√)
+ （可视化网页结果：模拟实盘）
  + 每日更新实时行情数据，计算因子(HYJ)
  + 模拟交易(MYJ)
+ 报告与课件(ZES)

### Backtesting Engine Updates

The backtesting engine has been updated to support loading market data from various file formats directly within the Rust core. Previously, the Python `Backtester` class would load the entire market data into memory before passing it to Rust. Now, the `Backtester` accepts a file path to the market data, and the Rust core handles the data loading based on the file's extension.

**Supported Market Data File Formats:**

*   `.parquet`: Efficient columnar storage format.
*   `.csv`: Standard comma-separated values format.
*   `.bin`: Binary format (requires a companion `.bin.json` file for metadata like `dtype` and `shape`).
*   `.pkl`: Python pickle format (assumes a pickled list of dictionaries with primitive types).

**Usage:**

When initializing the `Backtester` class in Python, you should now provide the file path to your market data instead of the loaded data itself.

```python
# Example of previous usage
# market_data = pd.read_parquet("path/to/market_data.parquet")
# backtester = Backtester(strategy, market_data, config)

# New usage
market_data_path = "path/to/your_market_data.parquet" # or .csv, .bin, .pkl
backtester = Backtester(strategy, market_data_path, config)
```

### Grouped Backtesting

The backtesting engine now supports grouped backtesting. This is useful when you have optimized weights for different groups of assets (e.g., from a layered optimization strategy).

**New `GroupedFactorStrategy`:**

A new strategy class, `GroupedFactorStrategy`, has been added. This strategy is designed to work with factor data that includes group information (a `group` column) and optimized weights (an `optimized_weight` column), typically generated by the `LayeredOptimizer`.

**New `run_grouped_backtest` Method:**

The `Backtester` class has a new method, `run_grouped_backtest`. This method:
1.  Retrieves signals with group information from the provided strategy (which should be an instance of `GroupedFactorStrategy`).
2.  Runs a separate backtest for each group.
3.  Plots the equity curve for each group's backtest.
4.  Returns a dictionary containing the portfolio history for each group.

**Usage:**

```python
# 1. Get your optimized factor data with group and weight information
#    (e.g., from LayeredOptimizer)
# optimized_factor_data = optimizer.optimize_layered_portfolio(...)

# 2. Initialize the GroupedFactorStrategy
grouped_strategy = GroupedFactorStrategy(optimized_factor_data, config)

# 3. Initialize the Backtester with the new strategy
backtester = Backtester(grouped_strategy, market_data_path, config)

# 4. Run the grouped backtest
group_results = backtester.run_grouped_backtest()
```
